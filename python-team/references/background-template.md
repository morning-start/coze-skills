# 项目背景知识文档

## 文档信息
- **项目名称**：<项目名称>
- **领域**：<技术领域或业务领域>
- **Python 版本要求**：3.11+
- **包管理工具**：UV
- **生成日期**：YYYY-MM-DD
- **知识来源**：网络搜索与整合
- **文档版本**：v1.0.0

---

## 项目背景概述
- **领域简介**：<对该技术/业务领域的简要介绍>
- **应用场景**：<典型应用场景>
- **核心概念**：<领域核心概念解释>

---

## 技术领域知识

### 核心技术概念
#### 概念1：<概念名称>
- **定义**：<技术概念的正式定义>
- **原理**：<工作原理或机制>
- **应用场景**：<何时使用>
- **注意事项**：<使用时需要注意的问题>

#### 概念2：<概念名称>
- **定义**：<技术概念的正式定义>
- **原理**：<工作原理或机制>
- **应用场景**：<何时使用>
- **注意事项**：<使用时需要注意的问题>

### 技术架构模式
#### 模式1：<模式名称>
- **适用场景**：<何时使用此模式>
- **优点**：<优势>
- **缺点**：<局限性>
- **实现要点**：<关键实现细节>
- **版本兼容性**：<兼容的Python版本>

#### 模式2：<模式名称>
- **适用场景**：<何时使用此模式>
- **优点**：<优势>
- **缺点**：<局限性>
- **实现要点**：<关键实现细节>
- **版本兼容性**：<兼容的Python版本>

---

## 数据库相关知识

### 数据库分类

#### 关系型数据库（RDBMS）
- **SQLite**：
  - 轻量级、文件型、零配置、嵌入式
  - 适合本地开发、移动端、小型应用
  - 不支持并发写入（写锁整个 DB）
  - Python 集成：sqlalchemy

- **PostgreSQL**：
  - 功能强大的开源关系数据库
  - 支持 JSON、全文搜索、地理空间（PostGIS）
  - 支持向量搜索（pgvector 插件）
  - 支持图查询（Apache AGE 插件）
  - Python 集成：psycopg2 + sqlalchemy

#### 文档型数据库（NoSQL）
- **MongoDB**：
  - 最流行的文档数据库，BSON 格式存储
  - 支持复杂查询、索引、聚合管道
  - Python 集成：pymongo

#### 向量数据库
- **pgvector**（PostgreSQL 插件）：
  - 在 PostgreSQL 中直接支持向量存储和搜索
  - 轻量、无需额外服务
  - Python 集成：pgvector-python

- **ChromaDB**：
  - 轻量级开源向量数据库
  - 专为 LLM 应用设计
  - 可嵌入或持久化
  - Python 集成：chromadb

- **Faiss**：
  - Meta 开发的高效向量搜索库
  - 本身不是完整数据库，需配合其他存储
  - Python 集成：faiss-cpu / faiss-gpu

#### 图数据库
- **Neo4j**：
  - 最主流的图数据库，支持 Cypher 查询
  - Python 集成：neo4j

- **Apache AGE**（PostgreSQL 插件）：
  - PostgreSQL 的官方图扩展
  - 支持在 PG 中使用 Cypher 查询
  - Python 集成：age

### 数据库设计原则
- **范式化**：减少数据冗余，提高一致性
- **反范式化**：提高查询性能，减少关联
- **索引策略**：为频繁查询的字段创建索引
- **分区策略**：大表按时间或维度分区
- **读写分离**：提高并发性能

### ORM 框架选择
- **SQLAlchemy**：
  - Python 最流行的 ORM 框架
  - 支持 Python 3.11+ 类型注解
  - 异步支持（SQLAlchemy 2.0）
  - 优势：成熟、灵活、支持多数据库

- **ODM**（MongoDB）：
  - MongoDB 官方 ODM
  - 类似 Django ORM 的 API
  - 类型注解支持

### 数据访问层设计
- **Repository 模式**：封装数据访问逻辑
- **数据抽象层**：提供统一接口，屏蔽底层差异
- **依赖注入**：便于测试和切换数据库

### 数据库迁移
- **Alembic**：SQLAlchemy 的数据库迁移工具
- **MongoDB 迁移**：使用自定义脚本或 pymongo-migrate

### 数据库性能优化
- **查询优化**：使用索引、避免 N+1 查询
- **连接池优化**：合理设置连接池大小
- **缓存策略**：使用 Redis 缓存热点数据
- **批量操作**：减少数据库往返次数

---

## 最佳实践与设计模式

### 代码编写最佳实践
- **规范1（类型注解）**：<具体规范及理由>
  - 示例：使用 PEP 585 内置泛型类型（`list[int]` 而非 `List[int]`）
- **规范2**：<具体规范及理由>
- **规范3**：<具体规范及理由>

### 架构设计最佳实践
- **原则1**：<设计原则及理由>
- **原则2**：<设计原则及理由>
- **原则3**：<设计原则及理由>

### 性能优化最佳实践
- **优化策略1**：<策略描述>
  - 适用场景：<何时应用>
  - 效果评估：<预期性能提升>
  - Python 3.11+ 特性：<如果适用>

- **优化策略2**：<策略描述>
  - 适用场景：<何时应用>
  - 效果评估：<预期性能提升>
  - Python 3.11+ 特性：<如果适用>

---

## 相关工具与框架对比

### 工具1 vs 工具2

#### 对比维度
| 维度 | 工具1 | 工具2 | 推荐场景 |
|------|-------|-------|----------|
| 学习曲线 | <简单/复杂> | <简单/复杂> | <推荐工具> |
| 性能 | <评估> | <评估> | <推荐工具> |
| 生态 | <丰富/有限> | <丰富/有限> | <推荐工具> |
| 文档质量 | <评估> | <评估> | <推荐工具> |
| 社区支持 | <活跃/一般> | <活跃/一般> | <推荐工具> |
| **版本兼容性** | <Python 3.11+支持> | <Python 3.11+支持> | <推荐工具> |
| **长期维护性** | <活跃/停滞> | <活跃/停滞> | <推荐工具> |
| **学习资源** | <丰富/有限> | <丰富/有限> | <推荐工具> |

#### 版本兼容性详情
- **工具1**：
  - 最新版本：<版本号>
  - Python 3.11+ 支持：✅ / ⚠️（需注意）/ ❌
  - 维护状态：<活跃/已弃用/停止维护>
  - 长期支持版本：<LTS版本>

- **工具2**：
  - 最新版本：<版本号>
  - Python 3.11+ 支持：✅ / ⚠️（需注意）/ ❌
  - 维护状态：<活跃/已弃用/停止维护>
  - 长期支持版本：<LTS版本>

#### 选型建议
- **推荐工具**：<工具名称>
- **理由**：<详细理由，引用上表对比结果>
- **权衡分析**：<性能 vs 易用性、功能 vs 复杂度>
- **不推荐场景**：<何种情况下不适用>

### 工具3 vs 工具4 vs 工具5

#### 功能对比
| 功能 | 工具3 | 工具4 | 工具5 |
|------|-------|-------|-------|
| 功能A | ✓ | ✗ | ✓ |
| 功能B | ✓ | ✓ | ✓ |
| 功能C | ✗ | ✓ | ✓ |

#### 性能对比
| 测试场景 | 工具3 | 工具4 | 工具5 |
|----------|-------|-------|-------|
| 场景1 | <结果> | <结果> | <结果> |
| 场景2 | <结果> | <结果> | <结果> |

#### 选型建议
- **场景A推荐**：<工具名称> - 理由：<具体原因>
- **场景B推荐**：<工具名称> - 理由：<具体原因>
- **Python 3.11+ 兼容性**：<综合评估>

---

## UV 包管理器

### UV 优势
- **速度快**：比 pip 快 10-100 倍
- **可靠性高**：使用 Rust 编写，并发下载，更好的依赖解析
- **锁定依赖**：自动生成 uv.lock，确保可复现性
- **现代化**：支持 pyproject.toml，符合 PEP 621 标准
- **开发体验好**：简化工作流，减少配置

### UV 基础命令
```bash
# 安装 UV
pip install uv

# 初始化项目
uv init

# 添加依赖
uv add requests

# 添加开发依赖
uv add --dev pytest

# 移除依赖
uv remove requests

# 更新依赖
uv lock --upgrade

# 同步环境
uv sync

# 运行脚本
uv run python main.py
```

### UV 配置文件
- **pyproject.toml**：项目配置和依赖声明
- **uv.lock**：锁定依赖版本（自动生成）

### UV 最佳实践
- 使用 `uv.lock` 锁定所有依赖版本
- 定期更新依赖：`uv lock --upgrade`
- 区分开发依赖：`uv add --dev package`
- 使用虚拟环境隔离项目依赖
- 提交 uv.lock 到版本控制

### UV vs pip 对比
| 维度 | UV | pip |
|------|----|-----|
| 速度 | 快 10-100 倍 | 较慢 |
| 依赖解析 | 更准确、更快 | 可能较慢 |
| 锁定文件 | uv.lock | requirements.txt（需手动） |
| 现代化 | ✅ | 传统 |
| 兼容性 | Python 3.8+ | Python 所有版本 |

---

## Loguru 日志库

### Loguru 优势
- **简单易用**：零配置，一行代码即可使用
- **功能强大**：支持日志轮转、压缩、异常捕获
- **性能优秀**：异步日志，高性能
- **现代化**：Python 3.11+ 类型注解支持

### Loguru 基础用法
```python
from loguru import logger

# 基础日志
logger.info("This is an info message")
logger.debug("Debug message")
logger.warning("Warning message")
logger.error("Error message")

# 异常捕获
try:
    1 / 0
except ZeroDivisionError:
    logger.exception("Division by zero")
```

### Loguru 配置
```python
from loguru import logger
import sys

# 移除默认处理器
logger.remove()

# 添加控制台输出
logger.add(
    sys.stdout,
    format="<green>{time:YYYY-MM-DD HH:mm:ss}</green> | <level>{level: <8}</level> | <cyan>{name}</cyan>:<cyan>{function}</cyan>:<cyan>{line}</cyan> - <level>{message}</level>",
    level="INFO"
)

# 添加文件输出（带轮转）
logger.add(
    "logs/app_{time:YYYY-MM-DD}.log",
    rotation="00:00",  # 每天轮转
    retention="30 days",  # 保留30天
    compression="zip",  # 压缩旧日志
    level="DEBUG"
)
```

### Loguru 最佳实践
- 在应用初始化时配置日志
- 使用不同的日志级别（DEBUG、INFO、WARNING、ERROR）
- 记录异常时使用 `logger.exception()`
- 生产环境使用文件日志，开发环境使用控制台日志
- 使用日志轮转和压缩避免日志文件过大

---

## 常见问题与解决方案

### 问题1：<问题描述>
- **现象**：<具体的错误表现>
- **原因**：<根本原因分析>
- **解决方案**：<详细解决步骤>
- **预防措施**：<如何避免再次发生>

### 问题2：<问题描述>
- **现象**：<具体的错误表现>
- **原因**：<根本原因分析>
- **解决方案**：<详细解决步骤>
- **预防措施**：<如何避免再次发生>

### 数据库常见问题

#### 连接问题
- **现象**：无法连接到数据库
- **原因**：连接字符串错误、数据库未启动、防火墙阻止
- **解决方案**：检查连接字符串、启动数据库、检查防火墙

#### 性能问题
- **现象**：查询缓慢
- **原因**：缺少索引、N+1 查询、数据量过大
- **解决方案**：添加索引、使用 eager loading、优化查询

#### 并发问题
- **现象**：SQLite 写入冲突
- **原因**：SQLite 不支持并发写入
- **解决方案**：使用 PostgreSQL、使用连接池、减少写操作

---

## 学习资源

### 官方文档
- <官方文档链接1>
- <官方文档链接2>
- <官方文档链接3>

### 推荐教程
- <教程链接1>
- <教程链接2>

### 社区资源
- <社区论坛链接>
- <GitHub 仓库链接>
- <Stack Overflow 标签>

### 数据库相关资源
- <数据库官方文档>
- <Python 数据库驱动文档>
- <数据库最佳实践指南>
