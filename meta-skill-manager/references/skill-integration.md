# 技能整合

## 目录
- [概述](#概述)
- [整合策略](#整合策略)
- [整合流程](#整合流程)
- [整合模式详解](#整合模式详解)
- [接口设计](#接口设计)
- [最佳实践](#最佳实践)

## 概述
技能整合是将多个技能的能力融合，创建功能更强大的复合技能的过程。

### 整合目标
1. **简化使用**: 将常用技能组合打包，降低用户使用复杂度
2. **能力增强**: 通过技能组合产生新的综合能力
3. **效率提升**: 减少重复操作和上下文切换
4. **标准化流程**: 固化最佳实践流程

### 适用场景
- 多个技能经常被一起使用
- 需要简化用户操作入口
- 组合后产生新的使用价值
- 需要标准化处理流程

### 整合原则
1. **能力互补**: 整合的技能应能力互补，避免重复
2. **接口兼容**: 技能间的输入输出接口应兼容
3. **低耦合**: 保持技能间的松耦合，便于独立使用
4. **清晰边界**: 明确每个技能在整合中的角色

## 整合策略

### 策略选择矩阵

| 场景特征 | 推荐策略 | 说明 |
|---------|---------|------|
| 数据依赖（A的输出是B的输入） | 顺序整合 | 按固定顺序执行 |
| 多维度处理 | 并行整合 | 同时处理不同维度 |
| 主流程+子任务 | 嵌套整合 | 在特定位置嵌入子技能 |
| 数据管道（ETL） | 流水线整合 | 清晰的数据流转 |
| 复杂场景 | 混合整合 | 组合多种策略 |

### 策略对比

| 策略 | 执行方式 | 数据流转 | 复杂度 | 适用场景 |
|------|---------|---------|--------|---------|
| 顺序 | 依次执行 | 串行传递 | 低 | 数据处理流程 |
| 并行 | 同时执行 | 分发+合并 | 中 | 多维度分析 |
| 嵌套 | 条件调用 | 父调子 | 中 | 可选功能模块 |
| 流水线 | 阶段处理 | 管道传递 | 高 | ETL流程 |

## 整合流程

### 流程概览
```
分析技能 → 选择策略 → 设计结构 → 定义接口 → 生成整合技能
```

### 详细步骤

#### 步骤 1: 分析待整合技能

**1.1 逐一理解每个技能**

对于每个待整合的技能，提取以下信息：
- **基本信息**: 名称、描述、版本
- **核心能力**: capabilities 列表
- **输入接口**: 需要什么数据/参数
- **输出接口**: 产生什么结果
- **依赖关系**: 依赖其他技能或资源
- **约束条件**: 使用限制、性能要求

**分析模板**:
```
技能名称: <name>
核心能力: [cap1, cap2, cap3]
输入: <输入描述和格式>
输出: <输出描述和格式>
依赖: [dep1, dep2]
约束: <约束说明>
```

**1.2 识别能力重叠和互补**

- **能力重叠**: 多个技能具有相同或相似能力
  - 处理方案: 去重，选择最优实现
  - 示例: 两个技能都有"格式转换"能力，保留功能更全面的一个

- **能力互补**: 技能间能力相互补充
  - 处理方案: 保留所有互补能力
  - 示例: 数据清洗 + 数据分析 + 报告生成

- **能力冲突**: 技能间能力存在矛盾或不兼容
  - 处理方案: 调和冲突或重新设计
  - 示例: 一个技能要求数据为 CSV，另一个要求为 JSON

**1.3 评估兼容性**

检查以下兼容性：
- [ ] **命名兼容性**: 技能名称无冲突
- [ ] **接口兼容性**: 输入输出格式可匹配
- [ ] **数据兼容性**: 数据格式可转换
- [ ] **依赖兼容性**: 依赖无冲突
- [ ] **语义兼容性**: 能力语义不矛盾

#### 步骤 2: 选择整合策略

根据分析结果选择合适的整合策略：

**顺序整合适用场景**:
- 技能间存在数据依赖关系
- 前一个技能的输出是后一个技能的输入
- 示例: 清洗 → 转换 → 验证

**并行整合适用场景**:
- 技能间无数据依赖，可独立执行
- 需要同时处理多个维度
- 示例: 同时分析文本情感、主题、关键词

**嵌套整合适用场景**:
- 存在主流程和可选子任务
- 需要在特定步骤调用特定功能
- 示例: 主流程中嵌入质量检查

**流水线整合适用场景**:
- 清晰的数据处理管道
- 每个阶段有明确的数据转换
- 示例: ETL 流程（提取 → 转换 → 加载）

#### 步骤 3: 设计整合技能结构

**3.1 确定新技能名称**

命名原则：
- 体现整合特性
- 使用小写字母+连字符
- 不以 `-skill` 结尾

命名示例：
- `data-analysis-suite`（数据分析套件）
- `content-processing-pipeline`（内容处理管道）
- `multi-source-analyzer`（多源分析器）

**3.2 编写整合描述**

描述格式：
```
整合技能描述 = 整合特性 + 包含能力 + 触发场景
```

描述示例：
```
"数据分析套件，整合数据清洗、统计分析和报告生成能力；当用户需要端到端数据分析解决方案时使用"
```

**3.3 定义整合后的能力列表**

整合能力列表 = 核心能力 + 整合带来的新能力

示例：
```yaml
# 原技能能力
data-cleaner: [数据清洗, 缺失值处理, 格式标准化]
data-analyzer: [统计分析, 趋势识别, 异常检测]
report-generator: [报告生成, 可视化, 导出]

# 整合后能力
data-analysis-suite:
  - 数据清洗
  - 缺失值处理
  - 格式标准化
  - 统计分析
  - 趋势识别
  - 异常检测
  - 报告生成
  - 可视化
  - 导出
  - 端到端数据分析（新增整合能力）
```

**3.4 设计整合后的操作流程**

根据整合策略设计流程：

顺序整合流程示例：
```
输入数据
  ↓
步骤1: 数据清洗（调用 data-cleaner）
  ↓ [清洗后的数据]
步骤2: 数据分析（调用 data-analyzer）
  ↓ [分析结果]
步骤3: 报告生成（调用 report-generator）
  ↓ [最终报告]
输出报告
```

并行整合流程示例：
```
输入数据
  ↓
├─→ 步骤A: 情感分析（并行）
│     ↓
├─→ 步骤B: 主题分析（并行）
│     ↓
└─→ 步骤C: 关键词提取（并行）
      ↓
步骤D: 结果合并
  ↓
输出综合分析结果
```

#### 步骤 4: 定义接口和映射

**4.1 设计统一输入接口**

统一输入应：
- 兼容所有子技能的输入需求
- 提供清晰的参数说明
- 支持可选参数

示例：
```yaml
整合技能输入:
  data_source: <数据源路径>
  format: <数据格式，如 csv/json>
  options:                # 可选参数
    cleaning_params: <清洗参数>
    analysis_params: <分析参数>
    report_params: <报告参数>
```

**4.2 定义技能间数据映射**

明确每个技能间的数据传递：
```
data-cleaner.output → data-analyzer.input
data-analyzer.output → report-generator.input
```

数据格式转换（如需要）：
```
步骤1输出: JSON
步骤2输入: CSV
转换: JSON → CSV（字段映射）
```

**4.3 设计输出格式**

整合技能输出应：
- 包含所有子技能的关键输出
- 提供统一的结果结构
- 支持多种导出格式

示例：
```yaml
整合技能输出:
  report: <最终报告>
  raw_data: <清洗后的原始数据>
  analysis_results: <分析结果>
  metadata: <处理元数据>
```

#### 步骤 5: 生成整合技能

**5.1 创建 SKILL.md**

前言区：
```yaml
---
name: <整合技能名称>
description: <整合描述>
metadata:
  composition_type: <整合策略>
  component_skills: [skill-1, skill-2, skill-3]
  integrated_capabilities: [能力列表]
---
```

正文结构：
```markdown
# <整合技能标题>

## 任务目标
- 本 Skill 用于: <说明整合后的用途>
- 能力包含: <整合后的能力列表>
- 整合来源: <说明整合了哪些技能>
- 触发条件: <触发场景>

## 前置准备
- 依赖说明: <整合后的依赖>
- 技能准备: <需要准备的子技能>

## 操作步骤
- 整合流程:
  1. <步骤1: 调用 skill-1>
  2. <步骤2: 数据转换>
  3. <步骤3: 调用 skill-2>
  4. <步骤4: 调用 skill-3>
  5. <步骤5: 结果合并>

- 数据映射:
  - skill-1.output → skill-2.input（格式: <格式说明>）
  - skill-2.output → skill-3.input（格式: <格式说明>）

## 资源索引
- 整合来源:
  - [skill-1](../skill-1/SKILL.md): <能力说明>
  - [skill-2](../skill-2/SKILL.md): <能力说明>
  - [skill-3](../skill-3/SKILL.md): <能力说明>
- 整合模式参考: [composition-patterns.md](composition-patterns.md)

## 注意事项
- <整合相关的注意事项>

## 使用示例
- <整合使用示例>
```

**5.2 补充整合元数据**

在 metadata 中记录整合信息：
```yaml
metadata:
  composition_type: sequential
  component_skills: [data-cleaner, data-analyzer, report-generator]
  integrated_from:
    - skill: data-cleaner
      version: "1.2.0"
      capabilities_used: [数据清洗, 缺失值处理]
    - skill: data-analyzer
      version: "2.0.0"
      capabilities_used: [统计分析, 趋势识别]
    - skill: report-generator
      version: "1.5.0"
      capabilities_used: [报告生成, 可视化]
  new_capabilities:
    - 端到端数据分析
    - 自动化报告生成
  data_mapping:
    - from: data-cleaner
      to: data-analyzer
      format: json
    - from: data-analyzer
      to: report-generator
      format: json
```

## 整合模式详解

### 顺序整合

**定义**: 技能按固定顺序执行，前一个输出作为后一个输入

**结构**:
```
Skill A → Skill B → Skill C
```

**适用场景**:
- 数据处理流程（清洗 → 转换 → 验证）
- 文档生成流程（收集 → 组织 → 生成）

**设计要点**:
1. 定义清晰的输入输出接口
2. 处理数据格式转换
3. 设计错误传播机制

**示例**: 数据分析套件
```
数据清洗 → 数据分析 → 报告生成
```

### 并行整合

**定义**: 多个技能同时执行，结果合并

**结构**:
```
      ├→ Skill A ┐
输入 ─┼→ Skill B ┼→ 合并 → 输出
      └→ Skill C ┘
```

**适用场景**:
- 多维度数据分析
- 批量独立任务处理

**设计要点**:
1. 定义输出合并策略
2. 处理并行执行的隔离
3. 统一错误处理

**示例**: 多维度内容分析
```
输入内容 → 情感分析（并行）
         → 主题分析（并行）
         → 关键词提取（并行）
         → 结果合并
```

### 嵌套整合

**定义**: 子技能嵌入父技能特定位置

**结构**:
```
父技能
  ├─ 步骤1
  ├─ 步骤2 → 子技能A
  ├─ 步骤3
  └─ 步骤4 → 子技能B
```

**适用场景**:
- 复杂任务分步实现
- 可选功能模块

**设计要点**:
1. 定义集成点
2. 参数传递机制
3. 结果处理

**示例**: 智能客服系统
```
客服主流程
  ├─ 接收问题
  ├─ 意图识别 → 调用分类器
  ├─ 匹配知识 → 调用检索器
  └─ 生成回复 → 调用生成器
```

### 流水线整合

**定义**: 定义清晰的数据流向和转换规则

**结构**:
```
输入 → [提取] → Skill A → [转换] → Skill B → [加载] → 输出
```

**适用场景**:
- ETL 流程
- 数据清洗管道

**设计要点**:
1. 定义数据流图
2. 阶段间契约
3. 数据格式验证

**示例**: 数据 ETL 管道
```
原始数据 → 提取阶段（数据提取）
         → 转换阶段（数据转换）
         → 标准化阶段（数据标准化）
         → 加载阶段（数据加载）
```

## 接口设计

### 输入接口设计

**统一输入原则**:
1. 参数命名清晰
2. 提供默认值
3. 支持可选参数
4. 参数验证规则

**示例**:
```yaml
input:
  required:
    - data_source: "数据源路径"
    - output_format: "输出格式（pdf/html/json）"
  optional:
    - cleaning_level: "清洗级别（basic/standard/advanced）"
      default: "standard"
    - analysis_depth: "分析深度（summary/detailed）"
      default: "summary"
    - include_charts: "是否包含图表"
      default: true
```

### 输出接口设计

**统一输出原则**:
1. 结构化输出
2. 包含元数据
3. 支持多格式
4. 错误信息规范

**示例**:
```yaml
output:
  content: "主要内容"
  metadata:
    processing_time: "处理时长"
    data_quality_score: "数据质量评分"
    record_count: "记录数"
  formats:
    - pdf: "PDF格式报告"
    - html: "HTML格式报告"
    - json: "结构化数据"
  errors: []  # 错误列表（如有）
```

### 技能间接口契约

**契约定义**:
```yaml
契约:
  skill_a_to_skill_b:
    from: skill-a
    to: skill-b
    input_format: json
    required_fields: [field1, field2, field3]
    optional_fields: [field4]
    validation_rules:
      - field1: "非空字符串"
      - field2: "数值类型"
```

## 最佳实践

### 整合前
- **充分分析**: 深入理解每个技能的能力和限制
- **评估兼容性**: 检查接口、数据、依赖兼容性
- **明确目标**: 清晰定义整合后的目标和价值

### 整合中
- **保持独立**: 尽量保持子技能的独立性
- **清晰映射**: 明确技能间的数据映射关系
- **容错设计**: 设计错误处理和回退机制

### 整合后
- **完整文档**: 详细说明整合逻辑和使用方法
- **版本管理**: 记录整合来源和版本信息
- **示例丰富**: 提供多种使用场景的示例

### 检查清单
- [ ] 分析了所有待整合技能的能力和接口
- [ ] 选择了合适的整合策略
- [ ] 设计了清晰的接口契约
- [ ] 定义了数据映射关系
- [ ] 设计了错误处理机制
- [ ] 生成了完整的整合技能文档
- [ ] 提供了使用示例
- [ ] 记录了整合来源和版本
